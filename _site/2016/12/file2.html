<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>邓小帅的Blog</title>
  <meta name="theme-color" content="#222222" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="http://localhost:4000//js/jquery.min.js"></script>
  <script src="http://localhost:4000//js/bootstrap.min.js"></script>
  <script src="http://localhost:4000//js/header.js"></script>
  <script src="http://localhost:4000//js/toc.js"></script>
  <link href="http://localhost:4000//css/bootstrap.min.css" rel="stylesheet">
  <link href="http://localhost:4000//css/theme.css" rel="stylesheet">
  <link href="http://localhost:4000//css/syntax.css" rel="stylesheet">
  <link href="http://localhost:4000//css/font-awesome/css/font-awesome.min.css" rel="stylesheet">
</head>

<body>

  

  


 <script type="text/javascript">
  WebFontConfig = {
    google: {
      families: ['Ubuntu::latin']
    }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://localhost:4000//">dengsir's blog</a>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="http://localhost:4000//">主页</a></li>
          <li><a href="http://localhost:4000//archive.html">文章</a></li>
          <li><a href="http://localhost:4000//tags.html">标签</a></li>
          <li><a href="http://localhost:4000//about.html">关于</a></li>
        </ul>
      </div>
    </div>
  </nav>


<div class="wrapper">
  <div class="content">
    <div class="container container-center">
      <div class="row">
        <div class="col-md-8">
          <div class="article">
            <div class="well">
              <h1><a href="http://localhost:4000//2016/12/file2">自定义对象的归档和解归档</a></h1>
              <div class="post-meta">
                <div class="post-time">
                  <i class="fa fa-calendar"></i>
                  <time>01 Dec 2016</time>
                </div>
                <ul>
                  
                    <li class="tagcloud"><a href="http://localhost:4000//tag/Object-C" class="color3" style="font-size: 12px;">Object-C</a></li>
                  
                </ul>
              </div>
              <hr>
              <div class="post-content">
                <div id="toc" class="toc"></div>
                <p>对对象进行归档，和对对象进行拷贝差不多路数，也就是需要协议，之前的时对NSString和NSNumber这些对象为什么没有归档协议？因为它们自带了。<br />
所以如果我们要对自定义的对象（而不是Foundation里默认的对象）进行归档的话就需要引入归档协议<NSCoding>。</NSCoding></p>

<p>举例：声明一个User类，然后创建一个对象user1，把这个user1进行归档，然后把归档后的文件解归档到user2中，看看是否是原先的那些数据。</p>

<p>（1）User.h<br />
        view plain copy 在CODE上查看代码片派生到我的代码片</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span>
    <span class="k">@interface</span> <span class="nc">User</span> <span class="p">:</span> <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">NSCoding</span><span class="o">&gt;</span> <span class="c1">//对自定义对象的归档和解归档需引入协议，就像要拷贝对象，那么这个类要引入拷贝协议一样
</span>
        <span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
        <span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span><span class="p">;</span>
        <span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">passwd</span><span class="p">;</span>
        <span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>

    <span class="k">@end</span>
</code></pre>
</div>

<p>（2）User.m<br />
        view plain copy 在CODE上查看代码片派生到我的代码片</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cp">#import "User.h"
</span>
    <span class="k">@implementation</span> <span class="nc">User</span>
    <span class="c1">//以下两个函数格式是系统默认，直接点击NSCoding查看并复制过来即可
</span>    <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">encodeWithCoder</span><span class="p">:(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aCoder</span><span class="p">{</span>
        <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeInt</span><span class="p">:</span><span class="n">_age</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"age"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">_name</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"name"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">_email</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"email"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">aCoder</span> <span class="nf">encodeObject</span><span class="p">:</span><span class="n">_passwd</span> <span class="nf">forKey</span><span class="p">:</span><span class="s">@"passwd"</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithCoder</span><span class="p">:(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDecoder</span><span class="p">{</span>
        <span class="n">self</span><span class="o">=</span><span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="o">!=</span><span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">_age</span><span class="o">=</span><span class="p">[</span><span class="n">aDecoder</span> <span class="nf">decodeIntForKey</span><span class="p">:</span><span class="s">@"age"</span><span class="p">];</span>
            <span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="p">[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"name"</span><span class="p">];</span>
            <span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="o">=</span><span class="p">[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"email"</span><span class="p">];</span>
            <span class="n">self</span><span class="p">.</span><span class="n">passwd</span><span class="o">=</span><span class="p">[</span><span class="n">aDecoder</span> <span class="nf">decodeObjectForKey</span><span class="p">:</span><span class="s">@"passwd"</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">@end</span>
</code></pre>
</div>

<p>（3）main.m<br />
[objc] view plain copy 在CODE上查看代码片派生到我的代码片</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    #import "User.h"
    #import &lt;Foundation/Foundation.h&gt;

    int main(int argc, const charchar * argv[])
    {
        @autoreleasepool {
            //初始化一个对象病赋值
            User *user1=[[User alloc]init];
            user1.age=20;
            user1.name=@"jack";
            user1.email=@"123@163.com";
            user1.passwd=@"123456";
            //创建文件路径
            NSString *filePath=[NSHomeDirectory() stringByAppendingPathComponent:@"self.arc"];
            //把这个对象归档
            BOOL success=[NSKeyedArchiver archiveRootObject:user1 toFile:filePath];
            if (success) {
                NSLog(@"success");
            }

            //解归档
            User *user2=[NSKeyedUnarchiver unarchiveObjectWithFile:filePath];//解归档到另一个对象中
            NSLog(@"%d,%@,%@,%@",user2.age,user2.name,user2.email,user2.passwd);//输出，完好
        }
        return 0;
    }
</code></pre>
</div>

<p>归档结果，生成一个文件：</p>

<p>解归档结果：<br />
[objc] view plain copy 在CODE上查看代码片派生到我的代码片<br />
20,jack,123@163.com,123456</p>

<p>结合之前的一篇笔记，总结：<br />
a：归档的时候，就是先有一个对象，然后有一个最终文件路径，然后利用[NSKeyedArchiver archiveRootObject:&lt;#(id)#&gt; toFile:&lt;#(NSString *)#&gt;]把对象归档到这个文件中；<br />
b：解归档就是，这个归档的对象是什么类型的，你就用什么类型的对象去接这个解归档生成的东西，解归档之后就可以正常使用这个对象了；<br />
c：归档其实有两种方式：上面总结是简单地就是直接把对象归档到一个文件里。还有一种复杂的就是上一个笔记用得例子，把数据对象data进行归 档»&gt;用归档函数把数据写入到data中»&gt;把data写入到最终文件中，解归档的路径是先把文件接成data 对象然后调用里面的数据，其实一般data是一个字典格式；<br />
d：根据对象是自带的还是自定义的，归档也有些许区别：自定义对象要实现归档，那么它的类必须引入归档协议<NSCoding>；
e：归档后的数据内容都是加密的。</NSCoding></p>

                

<div class="share-bar">
  <ul class="share-buttons">
    
    <li class="share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2016/12/file2" target="_blank" title="Share on Facebook">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-facebook fa-stack-1x"></i>
        </span>
      </a>
    </li>
    

    
    <li class="share-twitter">
      <a href="https://twitter.com/intent/tweet?url=http://localhost:4000/2016/12/file2&text=自定义对象的归档和解归档" target="_blank" title="Tweet">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-twitter fa-stack-1x"></i>
        </span>
      </a>
    </li>
    

    
    <li class="share-google-plus">
      <a href="https://plus.google.com/share?url=http://localhost:4000/2016/12/file2" target="_blank" title="Share on Google Plus">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-google-plus fa-stack-1x"></i>
        </span>
      </a>
    </li>
    

    
    <li class="share-linkedin">
      <a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/2016/12/file2&title=自定义对象的归档和解归档&summary=对对象进行归档，和对对象进行拷贝差不多路数，也就是需要协议，之前的时对NSString和NSNumber这些对象为什么没有归档协议？因为它们自带了。 所以如果我们要对自定义的对象（而不是Foundation里默认的对象）进行归档的话就需要引入归档协议<NSCoding>...&source=" target="_blank" title="Share on LinkedIn">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-linkedin fa-stack-1x"></i>
        </span>
      </a>
    </li>
    

    
    <li class="share-pinterest">
      <a href="http://pinterest.com/pin/create/button/?urlhttp://localhost:4000/2016/12/file2=&description=对对象进行归档，和对对象进行拷贝差不多路数，也就是需要协议，之前的时对NSString和NSNumber这些对象为什么没有归档协议？因为它们自带了。 所以如果我们要对自定义的对象（而不是Foundation里默认的对象）进行归档的话就需要引入归档协议<NSCoding>..." target="_blank" title="Pin it">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-pinterest fa-stack-1x"></i>
        </span>
      </a>
    </li>
    

    
    <li class="share-envelope">
      <a href="mailto:?&subject=自定义对象的归档和解归档&body=对对象进行归档，和对对象进行拷贝差不多路数，也就是需要协议，之前的时对NSString和NSNumber这些对象为什么没有归档协议？因为它们自带了。 所以如果我们要对自定义的对象（而不是Foundation里默认的对象）进行归档的话就需要引入归档协议<NSCoding>... http://localhost:4000/2016/12/file2" target="_blank" title="Email">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-envelope-o fa-stack-1x"></i>
        </span>
      </a>
    </li>
    

  </ul>
</div>


              </div>
              
            </div>
          </div>
        </div>
        <div class="col-md-4 hidden-xs">
          <div class="sidebar ">
  <div class="profilepic" style="text-align:center">
    <img class="img-circle" lazy-src="http://localhost:4000//images/avatar.png" alt="没错! 我就是邓小帅." style="width:100px; height:100px;" src="http://localhost:4000//images/avatar.png">
    <!--<img src="http://localhost:4000//images/fulls/img1.png" class="fit image">-->
    <br/>
    <h3>世上无难事, 只要肯放弃</h3>
    <hr>
  </div>
  <h2>最近发表文章</h2>
  <ul>
    
    <!--<div class="tagcloud">-->
      <!--<a href="http://localhost:4000//2016/12/file4" class="color5" style="font-size: 12px;">2016年12月学习技能清单</a>-->
    <!--</div>-->
    <li><a href="http://localhost:4000//2016/12/file4">2016年12月学习技能清单</a></li>
    <!--<hr>-->
    
    <!--<div class="tagcloud">-->
      <!--<a href="http://localhost:4000//2016/12/file1" class="color5" style="font-size: 12px;">利用多线程GCD定时器的实现</a>-->
    <!--</div>-->
    <li><a href="http://localhost:4000//2016/12/file1">利用多线程GCD定时器的实现</a></li>
    <!--<hr>-->
    
    <!--<div class="tagcloud">-->
      <!--<a href="http://localhost:4000//2016/12/file3" class="color5" style="font-size: 12px;">如何在Swift项目中使用OC类实现混编的解决方法</a>-->
    <!--</div>-->
    <li><a href="http://localhost:4000//2016/12/file3">如何在Swift项目中使用OC类实现混编的解决方法</a></li>
    <!--<hr>-->
    
    <!--<div class="tagcloud">-->
      <!--<a href="http://localhost:4000//2016/12/file2" class="color5" style="font-size: 12px;">自定义对象的归档和解归档</a>-->
    <!--</div>-->
    <li><a href="http://localhost:4000//2016/12/file2">自定义对象的归档和解归档</a></li>
    <!--<hr>-->
    
  </ul>
</div>

<div class="sidebar">
  <h2>标签</h2>
  <ul>
    
      <li><a href="http://localhost:4000//tag/Object-C">Object-C</a></li>
      <!--<hr>-->
    
      <li><a href="http://localhost:4000//tag/Skill">Skill</a></li>
      <!--<hr>-->
    
  </ul>
</div>

        </div>
      </div>
    </div>
    

  </div>
      <footer class="footer-distributed">
      <div class="container">
        <div class="footer">
          <p>dengsir's blog &copy; 2016</p>
          <h6>Follow me</h6>

<ul class="social-media">

  
    <li>
      <a title="dengkairong on Github" href="https://github.com/dengkairong" target="_blank"><i class="fa fa-github fa-2x"></i></a>
    </li>
  

  <!---->
    <!--<li>-->
      <!--<a title=" on StackOverflow" href="http://stackoverflow.com/users/" target="_blank"><i class="fa fa-stack-overflow fa-2x"></i></a>-->
    <!--</li>-->
  <!---->

  <!---->

  <!---->
    <!--<li>-->
      <!--<a title=" on Instagram" href="https://instagram.com/" target="_blank"><i class="fa fa-instagram fa-2x"></i></a>-->
    <!--</li>-->
  <!---->

  <!---->
    <!--<li>-->
      <!--<a title=" on Last.fm" href="http://lastfm.com/user/" target="_blank"><i class="fa fa-lastfm fa-2x"></i></a>-->
    <!--</li>-->
  <!---->

  <!---->
    <!--<li>-->
      <!--<a title="feed.xml RSS" href="//feed.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a>-->
    <!--</li>-->
  <!---->

</ul>

        </div>
      </div>
    </footer>
  </body>
</html>

</div>
